{"version":3,"sources":["webpack:///./src/components/Notes/Editor.vue","webpack:///./src/components/Notes/Editor.vue?9042","webpack:///./src/components/Notes/Editor.vue?d611","webpack:///./src/Phrasebook/Editor.vue?fc76","webpack:///./src/Phrasebook/Editor.vue?7852","webpack:///./src/Phrasebook/Editor.vue","webpack:///./src/Phrasebook/Context/TranslationEditor.vue","webpack:///./src/Phrasebook/Context/TranslationEditor.vue?8d7f","webpack:///./src/Phrasebook/Context/TranslationEditor.vue?7ada","webpack:///./src/Phrasebook/Editor.vue?48a8","webpack:///./src/Phrasebook/Editor.vue?5027"],"names":["icon","header","add","caption","notes","n","i","key","class","type","remove","components","EditorCard","props","modelValue","Array","default","undefined","emits","setup","emit","get","set","value","push","splice","render","file","corpus","section","s","name","phrase","phrases","p","id","preview","blocks","b","block","translation","addBlock","context","is-on","removeBlock","button","entities","e","colors","size","sizes","entity","tags","t","j","ButtonAlert","Object","contextSource","map","Math","max","length","_","entries","NotesEditor","VBlock","BlockEditor","VContext","ContextTranslationEditor","JSON","parse","localStorage","then","defaultFile","filename","storage","states","display","text","transition","index","indexOf","immediate","phraseContext","forEach","Set","split","__scopeId"],"mappings":"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","file":"js/chunk-216ffaa3.a2f0f1fd.js","sourcesContent":["<template>\n  <EditorCard icon=\"sticky_note_2\" header=\"Notes\" @action=\"add\">\n    <template #caption><slot /></template>\n    <div v-for=\"(n, i) in notes\" :key=\"i\" class=\"row\">\n      <input v-model=\"notes[i]\" type=\"text\" />\n      <btn icon=\"clear\" @click=\"remove(i)\" />\n    </div>\n  </EditorCard>\n</template>\n\n<script lang=\"ts\">\nimport { PropType, computed, defineComponent } from \"vue\";\nimport EditorCard from \"@/components/EditorCard.vue\";\n\nexport default defineComponent({\n  components: { EditorCard },\n  props: {\n    modelValue: { type: Array as PropType<string[]>, default: undefined },\n  },\n  emits: [\"update:modelValue\"],\n  setup(props, { emit }) {\n    const notes = computed({\n      get: () => props.modelValue,\n      set: (n) => emit(\"update:modelValue\", n),\n    });\n\n    function add() {\n      if (notes.value) notes.value.push(\"\");\n      else notes.value = [\"\"];\n    }\n    function remove(i: number) {\n      if (notes.value) notes.value.splice(i, 1);\n    }\n\n    return { notes, add, remove };\n  },\n});\n</script>\n","\nimport { PropType, computed, defineComponent } from \"vue\";\nimport EditorCard from \"@/components/EditorCard.vue\";\n\nexport default defineComponent({\n  components: { EditorCard },\n  props: {\n    modelValue: { type: Array as PropType<string[]>, default: undefined },\n  },\n  emits: [\"update:modelValue\"],\n  setup(props, { emit }) {\n    const notes = computed({\n      get: () => props.modelValue,\n      set: (n) => emit(\"update:modelValue\", n),\n    });\n\n    function add() {\n      if (notes.value) notes.value.push(\"\");\n      else notes.value = [\"\"];\n    }\n    function remove(i: number) {\n      if (notes.value) notes.value.splice(i, 1);\n    }\n\n    return { notes, add, remove };\n  },\n});\n","import { render } from \"./Editor.vue?vue&type=template&id=60866d64\"\nimport script from \"./Editor.vue?vue&type=script&lang=ts\"\nexport * from \"./Editor.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./Editor.vue?vue&type=style&index=0&id=260e72ec&lang=scss&scoped=true\"","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./Editor.vue?vue&type=style&index=1&id=260e72ec&lang=scss\"","<template>\n  <div v-if=\"file && corpus\" class=\"section col-2 small grid\">\n    <div class=\"col-2\">\n      <div class=\"col-1 wrap card\">\n        <div class=\"row-1\">\n          <p class=\"icon\">topic</p>\n          <h2 class=\"col-1 flex\">\n            <select v-model=\"section\">\n              <option v-for=\"s in corpus\" :key=\"s.name\" :value=\"s\">\n                {{ s.name }}\n              </option>\n            </select>\n          </h2>\n        </div>\n        <div v-if=\"section\" class=\"row-1\">\n          <p class=\"icon\">short_text</p>\n          <select v-model=\"phrase\">\n            <option v-for=\"p in section.phrases\" :key=\"p.id\" :value=\"p\">\n              {{ p.preview }}\n            </option>\n          </select>\n        </div>\n        <p class=\"text-faded text-caption\">\n          The source corpus is loading from what is saved on Phrasebook Corpus\n          editor page.\n        </p>\n        <template v-if=\"phrase?.blocks\">\n          <VContext />\n          <div class=\"row wrap\">\n            <VBlock\n              v-for=\"(b, i) in phrase.blocks\"\n              :key=\"phrase.id + '--' + i\"\n              :block=\"b\"\n            />\n          </div>\n        </template>\n      </div>\n      <template v-if=\"translation\">\n        <EditorCard icon=\"account_tree\" header=\"Blocks\" @action=\"addBlock\">\n          <template v-if=\"block\" #header>\n            <ButtonAlert @confirm=\"removeBlock\" />\n          </template>\n          <VContext :translation=\"translation.context\" />\n          <div class=\"row-1 wrap block-editor\">\n            <div\n              v-for=\"(b, i) in translation.blocks\"\n              :key=\"phrase.id + '--' + i\"\n              class=\"row\"\n            >\n              <btn icon=\"edit\" :is-on=\"block === b\" @click=\"block = b\" />\n              <VBlock :block=\"b\" />\n            </div>\n          </div>\n        </EditorCard>\n        <NotesEditor v-model=\"translation.notes\">\n          You can add notes, for example, to explain certain grammatical rules.\n        </NotesEditor>\n        <ContextTranslationEditor v-model=\"translation.context\">\n          Translate the context keys (entites & tags) to provide full phrase\n          localization.\n        </ContextTranslationEditor>\n      </template>\n    </div>\n    <BlockEditor v-if=\"block\" v-model=\"block\" @remove=\"removeBlock\" />\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport EditorCard from \"@/components/EditorCard.vue\";\nimport ButtonAlert from \"@/components/ButtonAlert.vue\";\nimport NotesEditor from \"@/components/Notes/Editor.vue\";\nimport VBlock from \"./Block/index.vue\";\nimport BlockEditor from \"./Block/Editor.vue\";\nimport VContext from \"./Context/index.vue\";\nimport ContextTranslationEditor from \"./Context/TranslationEditor.vue\";\n\nimport { defineComponent, ref, watch, nextTick, provide, toRaw } from \"vue\";\nimport { loadJSON } from \"@/store\";\nimport { setupEditor } from \"@/editor\";\nimport {\n  Block,\n  Context,\n  CorpusPhrase,\n  CorpusSection,\n  Phrase,\n  Phrasebook,\n} from \"./types\";\n\nexport default defineComponent({\n  components: {\n    EditorCard,\n    ButtonAlert,\n    NotesEditor,\n    VBlock,\n    BlockEditor,\n    VContext,\n    ContextTranslationEditor,\n  },\n  setup() {\n    const corpus = ref([] as CorpusSection[]);\n    try {\n      corpus.value = JSON.parse(localStorage[\"editor.phrasebookCorpus\"]);\n    } catch {\n      loadJSON(\"phrasebook\").then((j) => (corpus.value = j));\n    }\n    const section = ref({} as CorpusSection);\n    const phrase = ref({} as CorpusPhrase);\n    const translation = ref({} as Phrase);\n    const context = ref({} as Context);\n    const contextSource = ref({} as Context);\n    const block = ref({} as Block);\n    const file = setupEditor<Phrasebook>({\n      defaultFile: {},\n      filename: \"phrasebook\",\n      storage: \"editor.phrasebook\",\n    });\n\n    provide(\"context\", context);\n    provide(\"contextSource\", contextSource);\n\n    watch(corpus, (corpus) => (section.value = corpus[corpus.length - 1]), {\n      immediate: true,\n    });\n    watch(\n      section,\n      (section) => {\n        if (section?.phrases)\n          phrase.value = section.phrases[section.phrases.length - 1];\n      },\n      { immediate: true }\n    );\n    watch(\n      [phrase, file],\n      ([{ id, context: phraseContext }]) => {\n        if (!file.value[id]) file.value[id] = { blocks: [] };\n        translation.value = file.value[id];\n        nextTick(() => {\n          context.value = {};\n          contextSource.value = {};\n          phraseContext.forEach(({ entity, tags }) => {\n            context.value[entity] = new Set();\n            contextSource.value[entity] = new Set(tags.split(\" \"));\n          });\n        });\n      },\n      { immediate: true }\n    );\n    watch(\n      translation,\n      (translation) => {\n        if (translation?.blocks)\n          block.value = translation.blocks[translation.blocks.length - 1];\n      },\n      { immediate: true }\n    );\n    function addBlock() {\n      block.value = block.value = {\n        states: [{ display: [{ text: \"new state\" }], transition: \"next\" }],\n      };\n      translation.value.blocks.push(block.value);\n    }\n    function removeBlock() {\n      const blocks = toRaw(translation.value.blocks);\n      const index = blocks.indexOf(toRaw(block.value));\n      blocks.splice(index, 1);\n      block.value = blocks[blocks.length - 1];\n    }\n\n    return {\n      file,\n      corpus,\n      section,\n      phrase,\n      translation,\n      block,\n      addBlock,\n      removeBlock,\n    };\n  },\n});\n</script>\n\n<style lang=\"scss\" scoped>\n#header {\n  margin-top: -1 * map-get($margins, \"double\");\n  padding-top: 2 * map-get($margins, \"normal\");\n}\n.grid {\n  display: grid;\n  grid-template-columns: minmax(0, 1fr) minmax(0, 1.5fr);\n  gap: map-get($margins, \"double\");\n}\n@media only screen and (max-width: $mobile-width) {\n  .grid {\n    grid-template-columns: 100%;\n  }\n}\n</style>\n\n<style lang=\"scss\">\n.block-editor {\n  gap: 4px 8px;\n}\n</style>\n","<template>\n  <EditorCard\n    :button=\"translation ? '' : 'queue'\"\n    icon=\"format_list_bulleted\"\n    header=\"context translation\"\n    @action=\"add\"\n  >\n    <template #caption><slot /></template>\n    <template v-if=\"translation\" #header>\n      <ButtonAlert @confirm=\"translation = null\" />\n    </template>\n    <template v-if=\"translation\">\n      <div v-for=\"(e, i) in entities\" :key=\"i\" class=\"row wrap\">\n        <div class=\"row wrap block-editor\">\n          <div class=\"col\">\n            <h2 class=\"text-caption\" :class=\"colors[i]\">{{ e[0] }}</h2>\n            <input v-model=\"e[1]\" :size=\"sizes[i].entity\" type=\"text\" />\n          </div>\n          <div v-for=\"(t, j) in tags[i]\" :key=\"t[0]\" class=\"col\">\n            <p class=\"text-caption\">{{ t[0] }}</p>\n            <input v-model=\"t[1]\" :size=\"sizes[i].tags[j]\" type=\"text\" />\n          </div>\n        </div>\n      </div>\n    </template>\n  </EditorCard>\n</template>\n\n<script lang=\"ts\">\nimport ButtonAlert from \"@/components/ButtonAlert.vue\";\nimport EditorCard from \"@/components/EditorCard.vue\";\nimport { computed, defineComponent, inject, PropType, Ref } from \"vue\";\nimport { Context, ContextTranslation } from \"../types\";\n\nexport default defineComponent({\n  name: \"PhraseContextTranslationEditor\",\n  components: {\n    ButtonAlert,\n    EditorCard,\n  },\n  props: {\n    modelValue: {\n      type: Object as PropType<ContextTranslation[]>,\n      default: undefined,\n    },\n  },\n  emits: [\"update:modelValue\"],\n  setup(props, { emit }) {\n    const translation = computed({\n      get: () => props.modelValue,\n      set: (t) => emit(\"update:modelValue\", t),\n    });\n\n    const contextSource = inject(\"contextSource\", {} as Ref<Context>);\n    const entities = computed(() => translation.value?.map((t) => t.entity));\n    const tags = computed(() => translation.value?.map((t) => t.tags));\n    const sizes = computed(() =>\n      translation.value?.map(({ entity, tags }) => ({\n        entity: Math.max(entity[1].length, 1),\n        tags: tags.map((t) => Math.max(t[1].length, 1)),\n      }))\n    );\n    const colors = computed(() =>\n      entities.value?.map((_, i) => \"colored-dot-\" + i)\n    );\n    function add() {\n      translation.value = Object.entries(contextSource.value).map(\n        ([entity, tags]) => ({\n          entity: [entity, \"\"],\n          tags: [...tags].map((t) => [t, \"\"]),\n        })\n      );\n    }\n\n    return { translation, add, entities, tags, sizes, colors };\n  },\n});\n</script>\n","\nimport ButtonAlert from \"@/components/ButtonAlert.vue\";\nimport EditorCard from \"@/components/EditorCard.vue\";\nimport { computed, defineComponent, inject, PropType, Ref } from \"vue\";\nimport { Context, ContextTranslation } from \"../types\";\n\nexport default defineComponent({\n  name: \"PhraseContextTranslationEditor\",\n  components: {\n    ButtonAlert,\n    EditorCard,\n  },\n  props: {\n    modelValue: {\n      type: Object as PropType<ContextTranslation[]>,\n      default: undefined,\n    },\n  },\n  emits: [\"update:modelValue\"],\n  setup(props, { emit }) {\n    const translation = computed({\n      get: () => props.modelValue,\n      set: (t) => emit(\"update:modelValue\", t),\n    });\n\n    const contextSource = inject(\"contextSource\", {} as Ref<Context>);\n    const entities = computed(() => translation.value?.map((t) => t.entity));\n    const tags = computed(() => translation.value?.map((t) => t.tags));\n    const sizes = computed(() =>\n      translation.value?.map(({ entity, tags }) => ({\n        entity: Math.max(entity[1].length, 1),\n        tags: tags.map((t) => Math.max(t[1].length, 1)),\n      }))\n    );\n    const colors = computed(() =>\n      entities.value?.map((_, i) => \"colored-dot-\" + i)\n    );\n    function add() {\n      translation.value = Object.entries(contextSource.value).map(\n        ([entity, tags]) => ({\n          entity: [entity, \"\"],\n          tags: [...tags].map((t) => [t, \"\"]),\n        })\n      );\n    }\n\n    return { translation, add, entities, tags, sizes, colors };\n  },\n});\n","import { render } from \"./TranslationEditor.vue?vue&type=template&id=bf169a72\"\nimport script from \"./TranslationEditor.vue?vue&type=script&lang=ts\"\nexport * from \"./TranslationEditor.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","\nimport EditorCard from \"@/components/EditorCard.vue\";\nimport ButtonAlert from \"@/components/ButtonAlert.vue\";\nimport NotesEditor from \"@/components/Notes/Editor.vue\";\nimport VBlock from \"./Block/index.vue\";\nimport BlockEditor from \"./Block/Editor.vue\";\nimport VContext from \"./Context/index.vue\";\nimport ContextTranslationEditor from \"./Context/TranslationEditor.vue\";\n\nimport { defineComponent, ref, watch, nextTick, provide, toRaw } from \"vue\";\nimport { loadJSON } from \"@/store\";\nimport { setupEditor } from \"@/editor\";\nimport {\n  Block,\n  Context,\n  CorpusPhrase,\n  CorpusSection,\n  Phrase,\n  Phrasebook,\n} from \"./types\";\n\nexport default defineComponent({\n  components: {\n    EditorCard,\n    ButtonAlert,\n    NotesEditor,\n    VBlock,\n    BlockEditor,\n    VContext,\n    ContextTranslationEditor,\n  },\n  setup() {\n    const corpus = ref([] as CorpusSection[]);\n    try {\n      corpus.value = JSON.parse(localStorage[\"editor.phrasebookCorpus\"]);\n    } catch {\n      loadJSON(\"phrasebook\").then((j) => (corpus.value = j));\n    }\n    const section = ref({} as CorpusSection);\n    const phrase = ref({} as CorpusPhrase);\n    const translation = ref({} as Phrase);\n    const context = ref({} as Context);\n    const contextSource = ref({} as Context);\n    const block = ref({} as Block);\n    const file = setupEditor<Phrasebook>({\n      defaultFile: {},\n      filename: \"phrasebook\",\n      storage: \"editor.phrasebook\",\n    });\n\n    provide(\"context\", context);\n    provide(\"contextSource\", contextSource);\n\n    watch(corpus, (corpus) => (section.value = corpus[corpus.length - 1]), {\n      immediate: true,\n    });\n    watch(\n      section,\n      (section) => {\n        if (section?.phrases)\n          phrase.value = section.phrases[section.phrases.length - 1];\n      },\n      { immediate: true }\n    );\n    watch(\n      [phrase, file],\n      ([{ id, context: phraseContext }]) => {\n        if (!file.value[id]) file.value[id] = { blocks: [] };\n        translation.value = file.value[id];\n        nextTick(() => {\n          context.value = {};\n          contextSource.value = {};\n          phraseContext.forEach(({ entity, tags }) => {\n            context.value[entity] = new Set();\n            contextSource.value[entity] = new Set(tags.split(\" \"));\n          });\n        });\n      },\n      { immediate: true }\n    );\n    watch(\n      translation,\n      (translation) => {\n        if (translation?.blocks)\n          block.value = translation.blocks[translation.blocks.length - 1];\n      },\n      { immediate: true }\n    );\n    function addBlock() {\n      block.value = block.value = {\n        states: [{ display: [{ text: \"new state\" }], transition: \"next\" }],\n      };\n      translation.value.blocks.push(block.value);\n    }\n    function removeBlock() {\n      const blocks = toRaw(translation.value.blocks);\n      const index = blocks.indexOf(toRaw(block.value));\n      blocks.splice(index, 1);\n      block.value = blocks[blocks.length - 1];\n    }\n\n    return {\n      file,\n      corpus,\n      section,\n      phrase,\n      translation,\n      block,\n      addBlock,\n      removeBlock,\n    };\n  },\n});\n","import { render } from \"./Editor.vue?vue&type=template&id=260e72ec&scoped=true\"\nimport script from \"./Editor.vue?vue&type=script&lang=ts\"\nexport * from \"./Editor.vue?vue&type=script&lang=ts\"\n\nimport \"./Editor.vue?vue&type=style&index=0&id=260e72ec&lang=scss&scoped=true\"\nimport \"./Editor.vue?vue&type=style&index=1&id=260e72ec&lang=scss\"\nscript.render = render\nscript.__scopeId = \"data-v-260e72ec\"\n\nexport default script"],"sourceRoot":""}